<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò–≥—Ä–∞-–≥–æ–ª–æ–≤–æ–ª–æ–º–∫–∞</title>
    <style>
        body {
            margin: 0;
            font-family: Verdana;
            font-variant: small-caps;
            font-size: 14pt;
            background-color: rgb(19, 19, 21);
            color: rgba(240, 248, 255, 0.851);
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç–∏ */
        #game-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        #left-container {
            flex: 1;
            min-width: 500px;
            max-width: 1000px;
        }

        #right-container {
            flex: 0 0 auto;
            min-width: 300px;
        }

        #field {
            background-image: url("https://i.ibb.co/zJ4msXv/1.png");
            background-size: cover;
            background-position: center;
            width: 1000px;
            height: 600px;
            border: 2px solid rgb(10, 10, 10);
            outline: 4px solid rgb(53, 51, 56);
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            grid-template-rows: repeat(6, 1fr);
            position: relative;
        }

        .cell {
            border: 1px solid RGBA(255, 255, 255, 0.3);
            background-repeat: no-repeat;
            background-size: contain;
            background-position: center;
        }

        #character-wrapper {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        #character {
            position: absolute;
            width: 100px;
            height: 100px;
            background-image: url("https://i.ibb.co/bMn5drn8/image.png");
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            transition: all 0.3s ease;
            pointer-events: none;
        }

        .move {
            position: relative;
            padding: 0;
            margin: 0;
        }

        .move-picture {
            height: 100px;
            width: 100px;
        }

        .move-name {
            position: absolute;
            font-size: 11px;
            bottom: 43px;
            left: 4px;
            width: 92px;
            text-align: center;
            background-color: RGBA(255, 255, 255, 0.5);
            border-radius: 10px;
            padding: 0 3px 1px 3px;
            margin: 0;
            color: black;
            word-break: break-word;
            box-sizing: border-box;
        }

        .button {
            display: inline-block;
            background-color: rgb(57, 57, 69);
            padding: 10px;
            border: 2px solid rgb(0, 0, 0);
            outline: 4px solid rgb(38, 37, 40);
            text-align: center;
            cursor: pointer;
            margin: 5px;
            user-select: none;
        }

        #buttons {
            text-align: center;
        }

        .checked {
            background-color: rgb(100, 100, 113);
        }

        #sign-field {
            text-align: center;
            background-color: rgb(100, 100, 113);
            color: black;
            margin: 10px auto;
            padding: 10px;
            border: 2px solid rgb(0, 0, 0);
            outline: 4px solid rgb(38, 37, 40);
        }

        .mini-map {
            display: grid;
            grid-template-columns: repeat(10, 30px);
            grid-template-rows: repeat(6, 30px);
            gap: 1px;
            margin: 10px auto;
            justify-content: center;
        }

        .little-cell {
            width: 30px;
            height: 30px;
            border: 1px solid RGBA(0, 0, 0, 0.7);
            cursor: pointer;
            background-color: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .free {
            background-color: RGBA(255, 255, 255, 0.25);
        }

        .little-move {
            background-color: rgba(255, 255, 255, 0.668);
        }

        .bomb {
            background-color: rgba(255, 0, 0, 0.23)
        }

        .header {
            font-size: 16pt;
            font-weight: bold;
            margin-bottom: 10px;
        }

        #chat {
            margin-bottom: 20px;
        }

        #replay-button {
            padding: 10px 20px;
            background-color: rgb(57, 57, 69);
            border: 2px solid rgb(0, 0, 0);
            outline: 4px solid rgb(38, 37, 40);
            display: inline-block;
            margin-top: 10px;
            cursor: pointer;
            text-align: center;
        }

        #health-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin: 15px 0;
        }

        .health-icon {
            width: 40px;
            height: 40px;
            background-size: contain;
            background-repeat: no-repeat;
        }

        #chat {
            width: 100%;
            max-width: 550px;
            border: 2px solid rgb(0, 0, 0);
            outline: 4px solid rgb(38, 37, 40);
            background-color: rgb(32, 32, 39);
            padding: 20px;
            box-sizing: border-box;
            min-height: 80px;
        }

        #counter {
            margin-top: 10px;
            margin-right: 5px;
            display: inline-block;
            padding: 10px 10px 10px 0;
        }

        a {
            color: rgba(240, 248, 255, 0.851);
            font-weight: bold;
            text-decoration: none;
        }

        #to-main-page {
            margin-bottom: 25px;
            padding: 0 20px;
        }

        /* –ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è */
        @media (max-width: 768px) {
            #game-container {
                flex-direction: column;
                padding: 10px;
            }
            
            #left-container, #right-container {
                min-width: 100%;
                width: 100%;
            }
            
            #field {
                width: 100%;
                height: 60vw;
                max-height: 400px;
            }
            
            .cell {
                /* –†–∞–∑–º–µ—Ä—ã —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ grid */
            }
            
            #character {
                width: 16.66%;
                height: 16.66%;
            }
            
            body {
                font-size: 12pt;
            }
            
            .mini-map {
                grid-template-columns: repeat(10, 20px);
                grid-template-rows: repeat(6, 20px);
            }
            
            .little-cell {
                width: 20px;
                height: 20px;
                font-size: 10px;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <div id="to-main-page">
            <a href="#">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
        </div>
        
        <div id="game-container">
            <div id="left-container">
                <div id="field">
                    <!-- –°–µ—Ç–∫–∞ 6x10 –∫–ª–µ—Ç–æ–∫ -->
                    <div v-for="(row, rowIndex) in 6" :key="rowIndex" class="cell-row">
                        <div v-for="(col, colIndex) in 10" 
                             :key="colIndex" 
                             class="cell"
                             @click="mouseMove($event)"></div>
                    </div>
                    <div id="character-wrapper">
                        <div id="character" :style="characterStyle"></div>
                    </div>
                </div>
            </div>
            
            <div id="right-container">
                <div id="chat">
                    <div class="header">–°–æ–æ–±—â–µ–Ω–∏—è:</div>
                    <div id="message">{{ message }}</div>
                </div>
                
                <div class="header">–ó–¥–æ—Ä–æ–≤—å–µ:</div>
                <div id="health-container">
                    <div v-if="lifes >= 1" class="health-icon" style="background-image: url('https://via.placeholder.com/40/00ff00/000000?text=‚ô•')"></div>
                    <div v-else-if="lifes >= 0.5" class="health-icon" style="background-image: url('https://via.placeholder.com/40/ffff00/000000?text=‚ô•')"></div>
                    <div v-else class="health-icon" style="background-image: url('https://via.placeholder.com/40/ff0000/000000?text=‚ô•')"></div>
                </div>
                
                <div id="counter">
                    <div class="header">–ü–æ–±–µ–¥: {{ wins }}</div>
                </div>
                
                <div class="header">–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:</div>
                <div id="buttons">
                    <div class="button">1</div>
                    <div class="button">2</div>
                    <div class="button">3</div>
                    <div class="button">–ü–µ—Ä–µ—Ö–æ–¥</div>
                    <div class="button">–ú–∏–Ω–∞</div>
                    <div class="button">–û—á–∏—Å—Ç–∏—Ç—å</div>
                </div>
                
                <div id="sign-field">
                    <div class="header">–ö–∞—Ä—Ç–∞:</div>
                    <div class="mini-map">
                        <div v-for="(row, rowIndex) in 6" :key="rowIndex">
                            <div v-for="(col, colIndex) in 10" 
                                 :key="colIndex" 
                                 class="little-cell"
                                 @click="markCell($event)"></div>
                        </div>
                    </div>
                </div>
                
                <div style="text-align: center;">
                    <div id="replay-button" @click="replay">–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫</div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // –ò–ú–ü–û–†–¢–´
        import {createApp} from "https://unpkg.com/vue@3/dist/vue.esm-browser.prod.js"

        //–ö–û–ú–ü–û–ù–ï–ù–¢–ê
        const app = createApp({
            data() {
                return {
                    you: {
                        x: 0,
                        y: 0
                    },
                    field: [],
                    markedField: [],
                    selectedButton: null,
                    lifes: 1,
                    wins: 0,
                    message: "–ü–æ–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ. –ë—É–¥—å—Ç–µ –æ—Å—Ç–æ—Ä–æ–∂–Ω–µ–µ!",
                    isEnd: false,
                    isWin: false
                };
            },

            computed: {
                characterStyle() {
                    return {
                        transform: `translate(${this.you.x * 100}px, ${this.you.y * 100}px)`,
                        width: '100px',
                        height: '100px'
                    };
                }
            },

            methods: {
                // ... –≤—Å–µ –≤–∞—à–∏ –º–µ—Ç–æ–¥—ã –æ—Å—Ç–∞—é—Ç—Å—è —Ç–∞–∫–∏–º–∏ –∂–µ ...
                replay() {
                    this.lifes = 1;
                    this.generateField();
                    this.generateMarkedField();
                    this.you = { x: 0, y: 0 };
                    if (this.isEnd) {
                        this.message = "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–µ –ø–∞–¥–∞–π—Ç–µ –±–æ–ª—å—à–µ."
                    } else {
                        this.message = "–£—Ä–∞! –°–ª–µ–¥—É—é—â–∞—è –∫–∞—Ä—Ç–∞...";
                    }
                    this.isEnd = false;
                    this.isWin = false;
                    
                    const littleCells = document.querySelectorAll('.little-cell');
                    littleCells.forEach(cell => {
                        cell.className = 'little-cell';
                        cell.innerHTML = '';
                    });
                },

                countBombs() {
                    let count = 0;
                    let chance;
                    let alert = false;
                    for (let i of [-1, 0, 1]) {
                        for (let j of [-1, 0, 1]) {
                            try {
                                if (this.field[this.you.y + i][this.you.x + j] == 1) {
                                    count++;
                                    chance = Math.random() * 100;
                                    if (chance <= 10 && !alert) {
                                        alert = true;
                                    }
                                }
                            } catch (error) {}
                        }
                    }
                    const scenarios = ["–í—ã –Ω–∏—á–µ–≥–æ –Ω–µ —Å–ª—ã—à–∏—Ç–µ.", "–µ–¥–≤–∞ —Ä–∞–∑–ª–∏—á–∏–º—ã–π", "—Ç–∏—Ö–∏–π", "–ø—Ä–∏–≥–ª—É—à—ë–Ω–Ω—ã–π", "–≥—Ä–æ–º–∫–∏–π", "–æ—á–µ–Ω—å –≥—Ä–æ–º–∫–∏–π"];
                    let sound;
                    if (count == 0) {
                        sound = scenarios[0];
                    } else if (count > 0 && count < 5) {
                        sound = "–í—ã —Å–ª—ã—à–∏—Ç–µ " + scenarios[count] + " –∑–≤—É–∫ –æ—Å—ã–ø–∞—é—â–∏—Ö—Å—è –∫–∞–º–Ω–µ–π."
                    } else {
                        sound = "–í—ã —Å–ª—ã—à–∏—Ç–µ " + scenarios[5] + " –∑–≤—É–∫ –æ—Å—ã–ø–∞—é—â–∏—Ö—Å—è –∫–∞–º–Ω–µ–π."
                    }
                    return [count, sound];
                },

                checkIfDangerous() {
                    if (this.field[this.you.y][this.you.x] == 1) {
                        if (this.lifes == 1) {
                            this.message = "–í—ã –Ω–∞—Å—Ç—É–ø–∏–ª–∏ –Ω–∞ –æ–ø–∞—Å–Ω—É—é –∫–ª–µ—Ç–∫—É! –ë—É–¥—å—Ç–µ –æ—Å—Ç–æ—Ä–æ–∂–Ω–µ–µ."
                        } else {
                            this.isEnd = true;
                            this.message = "–í—ã –Ω–∞—Å—Ç—É–ø–∏–ª–∏ –Ω–∞ –æ–ø–∞—Å–Ω—É—é –∫–ª–µ—Ç–∫—É –∏ —É–ø–∞–ª–∏!"
                        }
                        this.lifes--;
                        return true;
                    }
                    return false;
                },

                checkIfWin() {
                    for (let i in this.field) {
                        for (let j in this.field[i]) {
                            if (this.field[i][j] != this.markedField[i][j]) {
                                return false;
                            }
                        }
                    }
                    return true;
                },

                selectButton(button) {
                    if (this.selectedButton != button && this.selectedButton != null) {
                        this.selectedButton.className = "button";
                    }
                    this.selectedButton = button;
                    this.selectedButton.className = "button checked";
                },

                markCell(event) {
                    const cell = event.currentTarget;
                    let text;
                    if (this.selectedButton != null) {
                        text = this.selectedButton.innerHTML;
                    } else return;

                    const cells = Array.from(document.querySelectorAll('.little-cell'));
                    const cellIndex = cells.indexOf(cell);
                    const row = Math.floor(cellIndex / 10);
                    const col = cellIndex % 10;

                    if (!isNaN(parseInt(text))) {
                        cell.innerHTML = text;
                        cell.className = "little-cell free";
                    } else if (text == "–ü–µ—Ä–µ—Ö–æ–¥") {
                        cell.innerHTML = "";
                        cell.className = "little-cell little-move";
                    } else if (text == "–ú–∏–Ω–∞") {
                        cell.innerHTML = "üí£";
                        cell.className = "little-cell bomb";
                    } else {
                        cell.innerHTML = "";
                        cell.className = "little-cell";
                    }

                    // –û–±–Ω–æ–≤–ª—è–µ–º markedField
                    if (text == "–ú–∏–Ω–∞") {
                        this.markedField[row][col] = 1;
                    } else if (text == "–û—á–∏—Å—Ç–∏—Ç—å") {
                        this.markedField[row][col] = 0;
                    } else if (text == "–ü–µ—Ä–µ—Ö–æ–¥") {
                        this.markedField[row][col] = -1;
                    }

                    this.isWin = this.checkIfWin();
                    if (this.isWin) {
                        this.wins += this.lifes == 1 ? 1 : 0.5;
                        this.message = "–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏!";
                    }
                },

                generateBombsCount() {
                    return 12 + Math.floor(Math.random() * 3);
                },

                generateMarkedField() {
                    this.markedField = [];
                    for (let i = 0; i < 6; i++) {
                        let row = [];
                        for (let j = 0; j < 10; j++) {
                            row.push(0);
                        }
                        this.markedField.push(row);
                    }
                    this.markedField[5][0] = -1;
                    this.markedField[3][9] = -1;
                },

                generateField() {
                    let flatField = [];
                    for (let i = 0; i < 60; i++) flatField.push(0);
                    
                    let bombs = this.generateBombsCount();
                    while (bombs > 0) {
                        let pos = Math.floor(Math.random() * 60);
                        if (flatField[pos] === 0) {
                            flatField[pos] = 1;
                            bombs--;
                        }
                    }

                    // –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–µ—Ö–æ–¥—ã
                    flatField[50] = -1; // [0][5] –≤ —Å—Ç–∞—Ä–æ–π —Å–∏—Å—Ç–µ–º–µ
                    flatField[39] = -1; // [9][3] –≤ —Å—Ç–∞—Ä–æ–π —Å–∏—Å—Ç–µ–º–µ

                    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ 2D –º–∞—Å—Å–∏–≤ 6x10
                    this.field = [];
                    for (let i = 0; i < 6; i++) {
                        this.field.push(flatField.slice(i * 10, (i + 1) * 10));
                    }
                },

                move(event) {
                    if (this.isEnd || this.isWin) return;

                    const keyMap = {
                        "KeyW": [0, -1], "KeyS": [0, 1],
                        "KeyA": [-1, 0], "KeyD": [1, 0],
                        "KeyQ": [-1, -1], "KeyE": [1, -1],
                        "KeyZ": [-1, 1], "KeyX": [1, 1]
                    };

                    const vector = keyMap[event.code];
                    if (!vector) return;

                    const newX = this.you.x + vector[0];
                    const newY = this.you.y + vector[1];

                    if (newX >= 0 && newX < 10 && newY >= 0 && newY < 6) {
                        this.you.x = newX;
                        this.you.y = newY;
                        
                        const dangerous = this.checkIfDangerous();
                        if (!dangerous) {
                            const [bombs, sound] = this.countBombs();
                            this.message = sound + " [" + bombs + "]";
                        }
                    }
                }
            },

            mounted() {
                this.generateField();
                this.generateMarkedField();
                
                const buttons = document.querySelectorAll(".button");
                buttons.forEach(button => {
                    button.onclick = () => this.selectButton(button);
                });

                document.addEventListener("keydown", this.move);
            }
        });

        app.mount('#app');
    </script>
</body>
</html>
